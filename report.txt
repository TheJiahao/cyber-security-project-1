Link to repository: https://github.com/TheJiahao/cyber-security-project-1
Installation (see README.md for better formatting):
- Install Node LTS v20.17.0 or newer (probably works) with a package manager (Homebrew (Mac), apt (Linux/Ubuntu), scoop (Windows), etc.) or download and use the installer from https://nodejs.org
  For apt in Ubuntu, run:
    sudo apt install nodejs
- Install pnpm with corepack or any method listed in https://pnpm.io/installation
  With corepack (shipped with Node) run:
    sudo corepack corepack enable
- Install dependencies:
    pnpm install
- Clone the repository:
    git clone git@github.com:TheJiahao/cyber-security-project-1.git

Running the application:
- Initialize database:
    pnpm run init:db
- Run the server:
    pnpm run dev

The flaws are from OWASP top ten list 2021.

The application lists all users with link to their profile page in home page http://127.0.0.1:3006 (by default).
To login or register, click the links in the navigation bar.
The attacks in the essay assumes that there is a user with username and passwords admin:admin. Before trying to make the attacks in the essay, register a user with such credentials.

A01:2021 – Broken Access Control:
https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/profileController.ts#L36
The API route that handles user description modification does not verify the identity of user.
To check the flaw, send the following HTTP POST request (without cookies):
POST http://127.0.0.1:3006/user/admin HTTP/1.1
Content-Type: application/json

{
    "description": "<script>alert('this is XSS attack')</script>"
}

To fix it, check that there is a JSON Web Token (JWT) in the cookies and check that the user has access to modify description.
The fix is commented in the source: https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/profileController.ts#L36

A02:2021 – Cryptographic Failures:
Passwords and tokens are transmitted over HTTP in clear text.
To check the flaw, capture traffic between your computer and the server with Wireshark or something similar.
To fix it, get a TLS/SSL certificate and configure HTTPS using it for the server to transmit encrypted passwords and tokens.

A03:2021 – Injection:
https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/views/profilePage.ejs#L9
The user profile page displays user-submitted description as raw HTML which is vulnerable to cross-site scripting (XSS).
The make an attack, register a user and set description to "<script>alert('this is XSS attack')</script>" or send the POST request described previously.
To fix it, escape dangerous symbols, such as "<" and ">", in the user input before storing into database and before sending it to an user.
In this project the latter fix (the template engine provides it) is in: https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/views/profilePage.ejs#L10
The former fix requires trying different packages (can be found with keyword "sanitize") and is therefore omitted here.

A07:2021 – Identification and Authentication Failures:
https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/registerController.ts#L21
https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/loginController.ts#L21
Passwords are stored as clear text. Utilising this in an attack requires access to the database file in the server.
However, the authentication requests have no rate limits. Therefore brute force attack, i.e. trying common or weak passwords with a script, is possible.
The following bcrypt-based fix fixes both problems. To fix the clear text problem, store only hashed version of passwords. For example, use bcrypt to hash the password.
The hashing fix: https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/registerController.ts#L25
To prevent brute force attacks, use a slow hash function, such as bcrypt, in authentication.
The bcrypt can be configured to run slow, such as 200 ms each time, for automated attack but fast enough for real users.
The slow hash comparison fix: https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/controllers/loginController.ts#L26

A05:2021 – Security Misconfiguration:
https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/config.ts#L2
The secret key (1234) used for signing JWT and cookies is too weak and hard coded as clear text in config file.
To make an attack with this:
- Register an user and get the JWT token from cookies
- Decode the token with https://10015.io/tools/jwt-encoder-decoder to get payload format and algorithm
- Encode the payload with replaced username and the weak secret key, this step can done automatically with common secret keys
- Set the token in cookies to the new token
- Do something bad with the fake token
To fix it, load the secret key from environment variables and use a more difficult key.
Fix: https://github.com/TheJiahao/cyber-security-project-1/blob/1433f4e50860a24c7f72156ba96bb665a33657e4/src/config.ts#L5
